<%- include('partials/header') %>
<%- include('partials/aside') %>

<section class="container">
  <div class="movies-list">
    <% if (movies && movies.length > 0) { %>
      <% movies.forEach(movie => { %>
        <article class="movie-card">
          <div class="movie-poster">
            <% if (movie.poster) { %>
              <img src="<%= movie.poster %>" alt="Movie Poster">
            <% } else { %>
              <p>No image</p>
            <% } %>
          </div>

          <div class="movie-info">
            <h3><%= movie.title %></h3>
            <ul>
              <% if (movie.genres && Array.isArray(movie.genres) && movie.genres.length > 0) { %>
                <li><strong>G√©nero:</strong> <%= movie.genres.join(', ') %></li>
              <% } %>

              <% if (movie.directors && movie.directors.length > 0) { %>
                <li><strong>Director:</strong> <%= movie.directors.join(', ') %></li>
              <% } %>

              <% if (movie.type) { %>
                <li><strong>Tipo:</strong> <%= movie.type %></li>
              <% } %>

              <% if (movie.imdb && typeof movie.imdb.rating !== 'undefined') { %>
                <li><strong>Calificaci√≥n:</strong> <%= movie.imdb.rating %></li>
              <% } %>

              <% if (movie.released) { %>
                <li><strong>A√±o:</strong> <%= new Date(movie.released).getFullYear() %></li>
              <% } else if (movie.year) { %>
                <li><strong>A√±o:</strong> <%= movie.year %></li>
              <% } %>

              <% if (movie.fullplot || movie.plot) { %>
                <p class="movie-description"><%= movie.fullplot || movie.plot %></p>
              <% } %>

              <footer>
                <% const encodedFilters = encodeURIComponent(JSON.stringify(filters)); %>
                <a href="/delete?_id=<%= movie._id.toString() %>&filters=<%= encodedFilters %>" 
                   onclick="return confirm('¬øEst√°s seguro?')" 
                   class="btn-delete">
                  üóëÔ∏è Eliminar
                </a>
              </footer>
            </ul>
          </div>
        </article>
      <% }) %>

      <!-- Paginaci√≥n -->
      <% if (totalPages > 1) { %>
        <div class="pagination">
          <div class="pagination-controls">
            <% const filtersEncoded = encodeURIComponent(JSON.stringify(filters)); %>

            <% if (currentPage > 1) { %>
              <a href="/movies?page=<%= currentPage - 1 %>&filters=<%= filtersEncoded %>" class="btn-pagination prev">‚¨ÖÔ∏è P√°gina anterior</a>
            <% } else { %>
              <span class="btn-pagination prev disabled">‚¨ÖÔ∏è P√°gina anterior</span>
            <% } %>

            <span class="page-info">P√°gina <%= currentPage %> de <%= totalPages %></span>

            <% if (currentPage < totalPages) { %>
              <a href="/movies?page=<%= currentPage + 1 %>&filters=<%= filtersEncoded %>" class="btn-pagination next">P√°gina siguiente ‚û°Ô∏è</a>
            <% } else { %>
              <span class="btn-pagination next disabled">P√°gina siguiente ‚û°Ô∏è</span>
            <% } %>
          </div>
        </div>
      <% } %>

    <% } else { %>
      <div class="no-movies-container">
        <p class="no-movies-message">No hay pel√≠culas para mostrar</p>
      </div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>